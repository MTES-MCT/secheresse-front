<script setup lang="ts">
import { Ref } from "vue";
import {
  Chart as ChartJS,
  Title,
  Tooltip,
  Legend,
  CategoryScale,
  LinearScale,
  LineElement,
  PointElement,
  LineController,
  TimeScale,
  ArcElement
} from 'chart.js';
import 'chartjs-adapter-luxon';
import api from "../../api";

definePageMeta({
  layout: 'basic',
})

const appName = useRuntimeConfig().public.appName;
useHead({
  title: `Statistiques - ${useRuntimeConfig().public.appName}`
})

const links: Ref<any[]> = ref([{"to": "/", "text": "Accueil"}, {"text": "Statistiques"}])

ChartJS.register(Title, Tooltip, Legend, LineElement, CategoryScale, LinearScale, PointElement, LineController, TimeScale, ArcElement)

const {data, error} = await api.getStats();
</script>

<template>
  <DsfrBreadcrumb :links='links'/>
  <div>
    <h1>Statistiques depuis le 10 Juillet 2023</h1>
    <template v-if="data">
      <div class="fr-grid-row fr-grid-row--top fr-grid-row--gutters">
        <div class="fr-col-12">
          <StatsLineChart :stats="data"/>
        </div>
        <div class="fr-col-12 fr-col-md-6">
          <StatsProfileRepartition :stats="data"/>
        </div>
        <div class="fr-col-12 fr-col-md-6">
          <DsfrCallout :title="data.subscriptions"
                       content="personnes abonnÃ©es aux notifications de changement de niveau d'alerte"
          />
        </div>
        <div class="fr-col-12">
          <StatsDepartementWrapper :stats="data"/>
        </div>
      </div>
    </template>
  </div>
</template>